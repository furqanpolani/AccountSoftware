extends ../layout

block content
    section#contact
        div.animated.bounceInUp
            section#content.table-layout
                .tray.tray-center(style='height: 311px;')
                    .panel.mb25.mt5#newCustomer.hidden
                        .panel-body.p20.pb10.admin-form
                            section.row.mbn
                                section.row.mb15
                                    .col-xs-6
                                        label.field.prepend-icon(for='customerName')
                                            input#customerName.event-name.gui-input.br-light.light(type='text' name='email' placeholder='Customer Name')
                                            label.field-icon(for='customerName')
                                                i.fa.fa-user
                                    .col-xs-6
                                        label.field.prepend-icon(for='email')
                                            input#email.event-name.gui-input.br-light.bg-light(type='text', name='email', placeholder='Customer Email Address')
                               
                                            label.field-icon(for='email')
                                                i.fa.fa-envelope-o
                                section.row.mb15
                                    .col-xs-6
                                        label.field.prepend-icon(for='referenceName')
                                            input#referenceName.event-name.gui-input.br-light.light(type='text', name='referenceName', placeholder='Refrence name')
                                            label.field-icon(for='referenceName')
                                                i.fa.fa-user
                                    .col-xs-6
                                        label.field.prepend-icon(for='deposit')
                                            input#deposit.form-control(type='number'  min="0" placeholder='Deposit Amount')
                                            label.field-icon(for='deposit')
                                                i.fa.fa-money
                                                
                                
                                section.row.mb15
                                    .col-xs-6
                                        label.field.prepend-icon(for='phoneNumber')
                                            input#phoneNumber.event-name.gui-input.bg-light.br-light(type='text', name='phoneNumber', placeholder='Customer Phone Number...')
                                            label.field-icon(for='phoneNumber')
                                                i.fa.fa-phone
                                    .col-xs-6
                                        label.field.prepend-icon(for='dob')
                                            input#dob.form-control(type='text' placeholder='Date of Birth')
                                            label.field-icon(for='dob')
                                                i.fa.fa-calendar

                                #tab1_3.tab-pane
                                    section
                                        label.field.prepend-icon(for='address')
                                            input#address.gui-input(type='text', name='address', placeholder='Street address')
                                            label.field-icon(for='address')
                                                i.fa.fa-map-marker
                                    
                                    section.row
                                        .col-md-3
                                            label.field.prepend-icon(for='postalCode')
                                                input#postalCode.gui-input(type='text', name='postalCode', placeholder='Zip')
                                                label.field-icon(for='postalCode')
                                                    i.fa.fa-certificate
                                        .col-md-4
                                            label.field.prepend-icon(for='city')
                                                input#city.gui-input(type='text', name='city', placeholder='City')
                                                label.field-icon(for='city')
                                                    i.fa.fa-building-o
                                        .col-md-5
                                            label.field.select(for='state')
                                                select#state(name='state')
                                                    option(value='') Choose state
                                                    option(value='AL') Alabama
                                                    option(value='AK') Alaska
                                                    option(value='AZ') Arizona
                                                    option(value='AR') Arkansas
                                                    option(value='CA') California
                                                    option(value='CO') Colorado
                                                    option(value='CT') Connecticut
                                                    option(value='DE') Delaware
                                                    option(value='DC') District Of Columbia
                                                    option(value='FL') Florida
                                                    option(value='GA') Georgia
                                                    option(value='HI') Hawaii
                                                    option(value='ID') Idaho
                                                    option(value='IL') Illinois
                                                    option(value='IN') Indiana
                                                    option(value='IA') Iowa
                                                    option(value='KS') Kansas
                                                    option(value='KY') Kentucky
                                                    option(value='LA') Louisiana
                                                    option(value='ME') Maine
                                                    option(value='MD') Maryland
                                                    option(value='MA') Massachusetts
                                                    option(value='MI') Michigan
                                                    option(value='MN') Minnesota
                                                    option(value='MS') Mississippi
                                                    option(value='MO') Missouri
                                                    option(value='MT') Montana
                                                    option(value='NE') Nebraska
                                                    option(value='NV') Nevada
                                                    option(value='NH') New Hampshire
                                                    option(value='NJ') New Jersey
                                                    option(value='NM') New Mexico
                                                    option(value='NY') New York
                                                    option(value='NC') North Carolina
                                                    option(value='ND') North Dakota
                                                    option(value='OH') Ohio
                                                    option(value='OK') Oklahoma
                                                    option(value='OR') Oregon
                                                    option(value='PA') Pennsylvania
                                                    option(value='RI') Rhode Island
                                                    option(value='SC') South Carolina
                                                    option(value='SD') South Dakota
                                                    option(value='TN') Tennessee
                                                    option(value='TX') Texas
                                                    option(value='UT') Utah
                                                    option(value='VT') Vermont
                                                    option(value='VA') Virginia
                                                    option(value='WA') Washington
                                                    option(value='WV') West Virginia
                                                    option(value='WI') Wisconsin
                                                    option(value='WY') Wyoming
                                                i.arrow.double
                                .pull-right
                                    button.btn.ladda-button.btn-dark.progress-button.progress-button#saveCustomer(type='button' onclick="addCustomer()" data-style='expand-right')
                                        span.ladda-label#saveButton Save
                                        span.ladda-spinner
                                        span.ladda-spinner
                                        .ladda-progress

                                    button.btn.ml10.ladda-button.btn-danger.progress-button.progress-button#cancel(type='button', data-style='expand-right')
                                        span.ladda-label Cancel
                                        span.ladda-spinner
                                        span.ladda-spinner
                                        .ladda-progress
                    .panel
                        header#topbar.ph10
                            .topbar-right.hidden-xs.hidden-sm
                                a.btn.btn-default.btn-sm.light.fw600.ml10#addingCustomer
                                    span.fa.fa-user.pr5
                                    |  Add Customer
                            .row
                                //- .col-md-4
                                //-     label.field.select
                                //-         input#searchCustomerList.form-control(type='text', onkeyup='myFunction()', placeholder='Search for names..')
                        div.panel.panel-visible
                            div.panel-body.pn.table-responsive
                                table.table.table-striped.table-hover#contactList(cellspacing="0" width="100%")                                   
                                    thead
                                        tr.bg-light
                                            th Name
                                            th Email
                                            th Phone Number
                                            th Action
                                    
                                    tbody
                                        each r,index in result.completeData.data    
                                            tr
                                                td#resultName #{r.name}
                                                td#resultEmail #{r.emailAddress}
                                                td#resultPhone #{r.phoneNumber}
                                            

                                                td.text-right
                                                    .btn-group.text-right
                                                        button.btn.btn-success.br2.btn-xs.fs12.dropdown-toggle(type='button', data-toggle='dropdown', aria-expanded='false')
                                                            | menu
                                                            span.caret.ml5
                                                        ul.dropdown-menu(role='menu')
                                                            li
                                                                a.edit(href='#' onclick='edit(\'' + index + '\')' ) Edit
                                                            li
                                                                a(href='#' onclick='del(\'' + index + '\')' ) Delete        
        //-         aside.tray.tray-right.tray290(style='height: 266px;')
        //-             .admin-form
        //-                 h4  Find Customer
        //-                 hr.short
        //-                 .section.mb10
        //-                     label.field.prepend-icon(for='customer-id')
        //-                         input#customer-id.gui-input(type='text', name='customer-id', placeholder='Customer ID #')
        //-                         label.field-icon(for='customer-id')
        //-                             i.fa.fa-user
        //-                 .section.mb10
        //-                     label.field.prepend-icon(for='customer-name')
        //-                         input#customer-name.gui-input(type='text', name='customer-name', placeholder='Customer Name')
        //-                         label.field-icon(for='customer-name')
        //-                             i.fa.fa-user
        //-                 .section.mb25
        //-                     label.field.prepend-icon(for='customer-email')
        //-                         input#customer-email.gui-input(type='text', name='customer-email', placeholder='Customer Email')
        //-                         label.field-icon(for='customer-email')
        //-                             i.fa.fa-envelope-o
        //-                 h5
        //-                     small Search Country
        //-                 .section.mb15
        //-                     label.field.select
        //-                         select#customer-location.empty(name='customer-location')
        //-                             option(value='0', selected='selected') Filter by Location
        //-                             option(value='1') United States
        //-                             option(value='2') Europe
        //-                             option(value='3') Asia
        //-                             option(value='4') India
        //-                         i.arrow.double
        //-                 h5
        //-                     small Search Company
        //-                 .section.mb15
        //-                     label.field.select
        //-                         select#customer-company.empty(name='customer-company')
        //-                             option(value='0', selected='selected') Filter by Company
        //-                             option(value='1') Apple
        //-                             option(value='2') Sony
        //-                             option(value='3') Envato
        //-                             option(value='4') Microsoft
        //-                             option(value='5') Google
        //-                         i.arrow.double
        //-                 h5
        //-                     small Registration Date
        //-                 .section.row
        //-                     .col-md-6
        //-                         label.field.prepend-icon(for='date1')
        //-                             input#date1.gui-input(type='text', name='date1', placeholder='01/01/14')
        //-                             label.field-icon(for='date1')
        //-                                 i.fa.fa-calendar
        //-                     .col-md-6
        //-                         label.field.prepend-icon(for='date2')
        //-                             input#date2.gui-input(type='text', name='date2', placeholder='06/01/15')
        //-                             label.field-icon(for='date2')
        //-                                 i.fa.fa-calendar
        //-                 hr.short
        //-                 .section
        //-                     button.btn.btn-default.btn-sm.ph25(type='button') Search
        //-                     label.field.option.ml15
        //-                         input(type='checkbox', name='info')
        //-                         span.checkbox
        //-                         span.text-muted Save Search
        //- aside#sidebar_right.nano.affix.has-scrollbar
        //-     .sidebar-right-content.nano-content.p15(tabindex='0', style='margin-right: -17px;')
        //-         h5.title-divider.text-muted.mb20
        //-             | Server Statistics
        //-             span.pull-right
        //-                 | 2013
        //-                 i.fa.fa-caret-down.ml5
        //-         .progress.mh5
        //-             .progress-bar.progress-bar-primary(role='progressbar', aria-valuenow='45', aria-valuemin='0', aria-valuemax='100', style='width: 44%')
        //-                 span.fs11 DB Request
        //-         .progress.mh5
        //-             .progress-bar.progress-bar-info(role='progressbar', aria-valuenow='45', aria-valuemin='0', aria-valuemax='100', style='width: 84%')
        //-                 span.fs11.text-left Server Load
        //-         .progress.mh5
        //-             .progress-bar.progress-bar-warning(role='progressbar', aria-valuenow='45', aria-valuemin='0', aria-valuemax='100', style='width: 61%')
        //-                 span.fs11.text-left Server Connections
        //-         h5.title-divider.text-muted.mt30.mb10 Traffic Margins
        //-         .row
        //-             .col-xs-5
        //-                 h3.text-primary.mn.pl5 132
        //-             .col-xs-7.text-right
        //-                 h3.text-success-dark.mn
        //-                     i.fa.fa-caret-up
        //-                     |  13.2%
        //-         h5.title-divider.text-muted.mt25.mb10 Database Request
        //-         .row
        //-             .col-xs-5
        //-                 h3.text-primary.mn.pl5 212
        //-             .col-xs-7.text-right
        //-                 h3.text-success-dark.mn
        //-                     i.fa.fa-caret-up
        //-                     |  25.6%
        //-         h5.title-divider.text-muted.mt25.mb10 Server Response
        //-         .row
        //-             .col-xs-5
        //-                 h3.text-primary.mn.pl5 82.5
        //-             .col-xs-7.text-right
        //-                 h3.text-danger.mn
        //-                     i.fa.fa-caret-down
        //-                     |  17.9%
        //-         h5.title-divider.text-muted.mt40.mb20
        //-             | Server Statistics
        //-             span.pull-right.text-primary.fw600 USA
        //-     .nano-pane
        //-         .nano-slider(style='height: 206px; transform: translate(0px, 0px);')           
            //- div.col-md-12
            //-     div.panel.panel-visible#spy2
            //-         div.panel-heading
            //-             div.panel-title.hidden-xs Customer List
            //-                 .pull-right
            //-                     button#addCustomer.btn.ladda-button.btn-info.btn-primary(type='button')
            //-                         span.ladda-label Add Customer
            //-                         span.ladda-spinner
            //-                         .ladda-progress

            //-         div.panel-body.pn.table-responsive
            //-             table.table.table-striped.table-hover#contactList(cellspacing="0" width="100%")
            //-                 thead
            //-                     tr
            //-                         th Customer Name
            //-                         th Email Address
            //-                         th Phone Number
            //-                         th Registered By
            //-                 tbody
            //-                     each result in data
            //-                         tr
            //-                             td #{result.name}
            //-                             td #{result.emailAddress}
            //-                             td #{result.phoneNumber}
            //-                             td #{result.Employee.name}
        include ../endScript.html

    script.
        //hiding for Add custoemr
        $('#addingCustomer').click(function(){
            $('#newCustomer').removeClass('hidden')
        });
        $('#cancel').click(function(){
            $('#newCustomer').addClass('hidden')
            $('#saveButton').text("save")
        });
        
        //autocomplete for reference name 
        var customerBackend = !{JSON.stringify(result.lookupData.data.customerArray)}
        var referenceInputId
        var movieTitleId 
        jQuery(document).ready(() =>{
            $('#referenceName').autocomplete({
                source: customerBackend,
                change: function (event, ui)                    
                        {   console.log('ui is ', ui.item.data.id)
                            referenceInputId = ui.item.data.id
                            console.log(referenceInputId)
                            alert(ui); 
                        } 

            })
        })

        // editing data 
        var editedData ; 
        var editFlag = false;
        var data = !{JSON.stringify(result.completeData.data)}
        console.log('edit data is ', data)
        
        function edit(id) {
            $('#saveButton').text("update")
            console.log("result is ", id)
            editedData = data[id]
            console.log('edited data in edit function is :', editedData)
            editFlag = true
            console.log('edit is clicked')
            $('#customerName').val(editedData.name)
            $('#address').val(editedData.address)
            $('#email').val(editedData.emailAddress)
            $('#phoneNumber').val(editedData.phoneNumber) 
            $('#city').val(editedData.city)
            $('#province').val(editedData.state)
            $('#postalCode').val(editedData.postalCode)
            $('#dob').val(editedData.dob)
            $('#referenceName').val()
            $('#deposit').val(editedData.depositAmount)
            console.log(editedData)
            $('#newCustomer').removeClass('hidden')
            
            
        }
        //edit Button functioning
        //- $('.edit').click(() =>{
        //-     editFlag = true
        //-     console.log('edit is clicked')
        //-     var obj = $('#edit').attr('data')
        //-     editedData = JSON.parse(obj);

        //-     $('#customerName').val(editedData.name)
        //-     $('#address').val(editedData.address)
        //-     $('#email').val(editedData.emailAddress)
        //-     $('#phone').val(editedData.phoneNumber) 
        //-     $('#city').val(editedData.city)
        //-     $('#province').val(editedData.state)
        //-     $('#postalCode').val(editedData.postalCode)
        //-     $('#dob').val(editedData.dob)
        //-     $('#referenceName').val()
        //-     $('#deposit').val(editedData.depositAmount)
        //-     console.log(editedData)
        //-     $('#newCustomer').removeClass('hidden')
            
            
        //- })

        

        //save Button functioning
        function addCustomer(){
            console.log('add customer Started')
            //getting data from user
            var userEntry = {
                    name: $('#customerName').val(),
                    address: $('#address').val(),
                    emailAddress: $('#email').val(),
                    phoneNumber: $('#phoneNumber').val(), 
                    city: $('#city').val(),
                    state: $('#province').val(),
                    postalCode: $('#postalCode').val(),
                    dob: $('#dob').val(),
                    referenceId: referenceInputId,
                    depositAmount: $('#deposit').val()
            }
            //  editing existing customer 
            if(editFlag == true){
                
                console.log('user Entry is ', userEntry)
                console.log('id is : ', editedData)
                editFlag = false
                
                $.ajax({
                    type: "PUT",
                    url: '/api/customerUpdate/'+editedData.id,
                    data: userEntry,
                    dataType: "json",
                    success: function(result){
                    if(result.status){
                        return new Promise ((resolve, reject) =>{
                            showNotify('Customer', 'Customer Updated', 'success')
                            resolve()
                        }).then(()=>{
                            window.location.href = "/customers"
                        })
                        
                    }
                
                },
                    error: function(err){
                       return new Promise ((resolve, reject) =>{
                            showNotify('Customer', 'Customer not Updated', 'error')
                            resolve()
                        }).then(()=>{
                            window.location.href = "/customers"
                        })
                }
                });
                
            }
            //  Creating new customer
            else{
                    
                console.log(userEntry);
                $.ajax({
                    type: "POST",
                    url: '/api/customer',
                    data: userEntry,
                    dataType: "json",
                    success: function(result){
                    if(result.status){
                        return new Promise ((resolve, reject) =>{
                            showNotify('Customer', 'Customer Created', 'success')
                            resolve()
                        }).then(()=>{
                            window.location.href = "/customers"
                        })
                        
                    }
                
                },
                    error: function(err){
                       return new Promise ((resolve, reject) =>{
                            showNotify('Customer', 'Customer not deleted', 'error')
                            resolve()
                        }).then(()=>{
                            window.location.href = "/customers"
                        })
                }
                }); 
            

            } 
        }
        $( function() {
            $( "#dob" ).datepicker();
        });
        //- $("#saveCustomer").click(() =>{
        //-     window.location.href = "/customers"
        //- })

        function del(index){
            let customer = data[index]
            let id = customer.id
            swal({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                  confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        type: "DELETE",
                        url: '/api/customer/'+id,
                        data: "customer",
                        dataType: "json",
                        success: function(res){
                            if(res.status){
                                swal(
                                    'Deleted!',
                                    'Your file has been deleted.',
                                    'success'
                                ).then(() =>{
                                    window.location.href = '/customers'
                                })
                                
                            }
                        
                        },
                        error: function(err){
                                swal(
                                    'not deleted!',
                                    'Your file has not been deleted.',
                                    'error'
                                ).then(() =>{
                                    window.location.href = '/customers'
                                })
                        }
                    })
                
                    //- swal(
                    //- 'Deleted!',
                    //- 'Your file has been deleted.',
                    //- 'success'
                    //- )
                }
            })
        }
            
        jQuery(document).ready(function()
         {
            $('#contactList').dataTable({
              "aoColumnDefs": [{
                'bSortable': false
              }],
              "oLanguage": {
                "oPaginate": {
                  "sPrevious": "",
                  "sNext": ""
                }
              },
              "iDisplayLength": 15,
              "aLengthMenu": [
                [15, 25, 35, 50, -1],
                [15, 25, 35, 50, "All"]
              ],
              "sDom": '<"dt-panelmenu clearfix"lfr>t<"dt-panelfooter clearfix"ip>'
            });

            


            });
