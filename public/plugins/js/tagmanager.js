!function(t){"use strict";var a={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,externalTagId:!1,prefillIdFieldName:"Id",prefillValueFieldName:"Value",AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1,tagList:null,fillInputOnTagRemove:!1},e={pushTag:function(a,e,l){var r,n,s,o,d,p,u,g,h,c,m=t(this),f=m.data("opts"),v=m.data("tlis"),T=m.data("tlid");if((a=i.trimTag(a,f.delimiterChars))&&!(a.length<=0)){if(f.onlyTagList&&void 0!==f.tagList&&f.tagList){var C=f.tagList;if(t.each(C,function(t,a){C[t]=a.toLowerCase()}),-1===t.inArray(a.toLowerCase(),C))return}f.CapitalizeFirstLetter&&a.length>1&&(a=a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()),f.validator&&!f.validator(a)||f.maxTags>0&&v.length>=f.maxTags||(r=!1,n=jQuery.map(v,function(t){return t.toLowerCase()}),-1!==(d=t.inArray(a.toLowerCase(),n))&&(r=!0),r?(m.trigger("tm:duplicated",a),t("#"+m.data("tm_rndid")+"_"+T[d]).stop().animate({backgroundColor:f.blinkBGColor_1},100).animate({backgroundColor:f.blinkBGColor_2},100).animate({backgroundColor:f.blinkBGColor_1},100).animate({backgroundColor:f.blinkBGColor_2},100).animate({backgroundColor:f.blinkBGColor_1},100).animate({backgroundColor:f.blinkBGColor_2},100)):(!0===f.externalTagId?(void 0===l&&t.error("externalTagId is not passed for tag -"+a),o=l):(s=(s=Math.max.apply(null,T))===-1/0?0:s,o=++s),e||m.trigger("tm:pushing",[a,o]),v.push(a),T.push(o),e||null!==f.AjaxPush&&null==f.AjaxPushAllTags&&-1===t.inArray(a,f.prefilled)&&t.post(f.AjaxPush,t.extend({tag:a},f.AjaxPushParameters)),p=m.data("tm_rndid")+"_"+o,u=m.data("tm_rndid")+"_Remover_"+o,g=t("<span/>").text(a).html(),h='<span class="'+i.tagClasses.call(m)+'" id="'+p+'">',h+="<span>"+g+"</span>",h+='<a href="#" class="tm-tag-remove" id="'+u+'" TagIdToRemove="'+o+'">',h+=f.tagCloseIcon+"</a></span> ",c=t(h),null!==f.tagsContainer?t(f.tagsContainer).append(c):T.length>1?t("#"+m.data("tm_rndid")+"_"+T[T.length-2]).after(c):m.before(c),c.find("#"+u).on("click",m,function(a){a.preventDefault();var e=parseInt(t(this).attr("TagIdToRemove"));i.spliceTag.call(m,e,a.data)}),i.refreshHiddenTagList.call(m),e||m.trigger("tm:pushed",[a,o]),i.showOrHide.call(m)),m.val(""))}},popTag:function(){var a,e,l=t(this),r=l.data("tlis"),n=l.data("tlid");n.length>0&&(a=n.pop(),e=r[r.length-1],l.trigger("tm:popping",[e,a]),r.pop(),t("#"+l.data("tm_rndid")+"_"+a).remove(),i.refreshHiddenTagList.call(l),l.trigger("tm:popped",[e,a]))},empty:function(){for(var a,e=t(this),l=e.data("tlis"),r=e.data("tlid");r.length>0;)a=r.pop(),l.pop(),t("#"+e.data("tm_rndid")+"_"+a).remove(),i.refreshHiddenTagList.call(e);e.trigger("tm:emptied",null),i.showOrHide.call(e)},tags:function(){return this.data("tlis")}},i={showOrHide:function(){var t=this,a=t.data("opts"),e=t.data("tlis");a.maxTags>0&&e.length<a.maxTags&&(t.show(),t.trigger("tm:show")),a.maxTags>0&&e.length>=a.maxTags&&(t.hide(),t.trigger("tm:hide"))},tagClasses:function(){var a,e=t(this),i=e.data("opts"),l=i.tagBaseClass,r=i.inputBaseClass;return a=l,e.attr("class")&&t.each(e.attr("class").split(" "),function(t,e){-1!==e.indexOf(r+"-")&&(a+=" "+l+e.substring(r.length))}),a+=i.tagClass?" "+i.tagClass:""},trimTag:function(a,e){var i;for(a=t.trim(a),i=0;i<a.length&&-1===t.inArray(a.charCodeAt(i),e);i++);return a.substring(0,i)},refreshHiddenTagList:function(){var a=t(this),e=a.data("tlis"),i=a.data("lhiddenTagList");i&&t(i).val(e.join(a.data("opts").baseDelimiter)).change(),a.trigger("tm:refresh",e.join(a.data("opts").baseDelimiter))},killEvent:function(t){t.cancelBubble=!0,t.returnValue=!1,t.stopPropagation(),t.preventDefault()},keyInArray:function(a,e){return-1!==t.inArray(a.which,e)},applyDelimiter:function(a){var i=t(this);e.pushTag.call(i,t(this).val()),a.preventDefault()},prefill:function(a){var i=t(this),l=i.data("opts");t.each(a,function(t,a){!0===l.externalTagId?e.pushTag.call(i,a[l.prefillValueFieldName],!0,a[l.prefillIdFieldName]):e.pushTag.call(i,a,!0)})},pushAllTags:function(a,e){var i=t(this),l=i.data("opts"),r=i.data("tlis");l.AjaxPushAllTags&&("tm:pushed"===a.type&&-1!==t.inArray(e,l.prefilled)||t.post(l.AjaxPush,t.extend({tags:r.join(l.baseDelimiter)},l.AjaxPushParameters)))},spliceTag:function(a){var e,l=this,r=l.data("tlis"),n=l.data("tlid"),s=t.inArray(a,n);-1!==s&&(e=r[s],l.trigger("tm:splicing",[e,a]),t("#"+l.data("tm_rndid")+"_"+a).remove(),r.splice(s,1),n.splice(s,1),i.refreshHiddenTagList.call(l),l.trigger("tm:spliced",[e,a])),i.showOrHide.call(l)},init:function(l){var r,n,s=t.extend({},a,l);return s.hiddenTagListName=null===s.hiddenTagListName?"hidden-"+this.attr("name"):s.hiddenTagListName,r=s.delimeters||s.delimiters,n=[9,13,17,18,19,37,38,39,40],s.delimiterChars=[],s.delimiterKeys=[],t.each(r,function(a,e){-1!==t.inArray(e,n)?s.delimiterKeys.push(e):s.delimiterChars.push(e)}),s.baseDelimiter=String.fromCharCode(s.delimiterChars[0]||44),s.tagBaseClass="tm-tag",s.inputBaseClass="tm-input",t.isFunction(s.validator)||(s.validator=null),this.each(function(){var a=t(this),l="",r="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(a.data("tagManager"))return!1;a.data("tagManager",!0);for(var o=0;o<5;o++)r+=n.charAt(Math.floor(Math.random()*n.length));if(a.data("tm_rndid",r),a.data("opts",s).data("tlis",[]).data("tlid",[]),null===s.output?(l=t("<input/>",{type:"hidden",name:s.hiddenTagListName}),a.after(l),a.data("lhiddenTagList",l)):a.data("lhiddenTagList",t(s.output)),s.AjaxPushAllTags&&(a.on("tm:spliced",i.pushAllTags),a.on("tm:popped",i.pushAllTags),a.on("tm:pushed",i.pushAllTags)),a.on("focus keypress",function(a){t(this).popover&&t(this).popover("hide")}),s.isClearInputOnEsc&&a.on("keyup",function(a){27===a.which&&(t(this).val(""),i.killEvent(a))}),a.on("keypress",function(t){i.keyInArray(t,s.delimiterChars)&&i.applyDelimiter.call(a,t)}),a.on("keydown",function(t){13===t.which&&s.preventSubmitOnEnter&&i.killEvent(t),i.keyInArray(t,s.delimiterKeys)&&i.applyDelimiter.call(a,t)}),s.deleteTagsOnBackspace&&a.on("keydown",function(l){i.keyInArray(l,s.backspace)&&t(this).val().length<=0&&(e.popTag.call(a),i.killEvent(l))}),s.fillInputOnTagRemove&&a.on("tm:popped",function(a,e){t(this).val(e)}),a.change(function(t){/webkit/.test(navigator.userAgent.toLowerCase())||a.focus(),i.killEvent(t)}),null!==s.prefilled)"object"==typeof s.prefilled?i.prefill.call(a,s.prefilled):"string"==typeof s.prefilled?i.prefill.call(a,s.prefilled.split(s.baseDelimiter)):"function"==typeof s.prefilled&&i.prefill.call(a,s.prefilled());else if(null!==s.output){if(t(s.output)&&t(s.output).val())t(s.output);i.prefill.call(a,t(s.output).val().split(s.baseDelimiter))}}),this}};t.fn.tagsManager=function(a){var l=t(this);return 0 in this?e[a]?e[a].apply(l,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?(t.error("Method "+a+" does not exist."),!1):i.init.apply(this,arguments):this}}(jQuery);
